---
layout: base
---
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <img id="toc-toggle" class="toc-ctrl-btn" aria-expanded="true" aria-controls="toc-side" title="hide table of contents"
    src="/assets/imgs/double-alt-arrow-left.svg" />
  <div id="toc-side" class="table-of-contents">
    <a href="#{{ page.title | escape }}"><b>{{ "目录" | escape }}</b></a>
    {{ content | toc_only }}
  </div>
  <img id="toc-reveal" class="toc-ctrl-btn" aria-hidden="true" title="display table of contents"
    src="/assets/imgs/double-alt-arrow-right.svg" />
  <div class="post-content">
    <div class="post-body">
      <header class="post-header" id="{{ page.title | escape }}">
        <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
        <p class="post-meta">
          {%- assign date_format = site.minima.date_format | default: "%F" -%}
          <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
            {{ page.date | date: date_format }}
          </time>
          {%- if page.modified_date -%}
          ~
          {%- assign mdate = page.modified_date | date_to_xmlschema -%}
          <time class="dt-modified" datetime="{{ mdate }}" itemprop="dateModified">
            {{ mdate | date: date_format }}
          </time>
          {%- endif -%}
          {%- if page.author -%}
          • {% for author in page.author %}
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">{{ author }}</span></span>
          {%- if forloop.last == false %}, {% endif -%}
          {% endfor %}
          {%- endif -%}
        </p>
      </header>

      <div id="toc-header" class="table-of-contents">
        {% capture toc_size %}{{ content | toc_only | size }}{% endcapture %}
        {% assign toc_size = toc_size | plus: 0 %}
        <a href="#{{ page.title | escape }}"><b>{{ "目录" | escape }}</b></a>
        {{ content | toc_only }}
      </div>

      <div class="post-content e-content" itemprop="articleBody">
        {{ content }}
      </div>

      {%- if site.disqus.shortname -%}
      {%- include disqus_comments.html -%}
      {%- endif -%}

      <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
    </div>

    {%- include footer.html -%}
  </div>
</article>

<script>
  function setAria(expanded) {
    var btn = document.getElementById('toc-toggle');
    if (!btn) return;
    btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    var reveal = document.getElementById('toc-reveal');
    if (reveal) reveal.setAttribute('aria-hidden', expanded ? 'true' : 'false');
  }

  document.addEventListener('DOMContentLoaded', function () {
    var toggle = document.getElementById('toc-toggle');
    var reveal = document.getElementById('toc-reveal');
    var toc = document.getElementById('toc-side');
    var content = document.querySelector('.post-content');
    if (!toggle || !toc || !content) return;

    function layoutToc() {
      var tocRect = toc.getBoundingClientRect();
      var contentRect = content.getBoundingClientRect();
      var gap = 16; // space between toc right edge and article left
      var defaultW = 220;
      var available = Math.floor(contentRect.left - tocRect.left - gap);
      if (available >= defaultW) {
        toc.style.width = defaultW + 'px';
        toc.classList.remove('toc-truncate');
      } else if (available > 80) {
        toc.style.width = available + 'px';
        toc.classList.add('toc-truncate');
      } else {
        // very narrow: keep minimal width and truncate
        toc.style.width = '80px';
        toc.classList.add('toc-truncate');
      }
    }

    // initial layout and on resize/scroll
    layoutToc();
    window.addEventListener('resize', layoutToc);
    window.addEventListener('scroll', layoutToc);

    toggle.addEventListener('click', function (e) {
      document.body.classList.toggle('toc-collapsed');
      var expanded = !document.body.classList.contains('toc-collapsed');
      setAria(expanded);
      // recalc to update reveal position when collapsed/expanded
      setTimeout(layoutToc, 60);
    });

    if (reveal) {
      reveal.addEventListener('click', function (e) {
        document.body.classList.remove('toc-collapsed');
        setAria(true);
        setTimeout(layoutToc, 60);
      });
    }
  });

</script>