---
layout: post
title:  "周记"
date:   2024-04-14 09:46:09 +0800
categories: post
---

[B+ 树](https://oi-wiki.org/ds/bplus-tree/)

`set_autocommit=0` 长连接会导致长事务，长事务会导致很大的 undo log 日志，也会占用锁资源，可能拖垮数据库。

避免长事务，从开发的角度：

- 注意 `set_autocommit=1`
- 避免不必要的只读事务
- 设置语句的最长执行时间 `SET MAX_EXECUTION_TIME`。

最左匹配原则：从最左边为起点开始连续匹配，遇到范围查询（<、>、between、like）会停止匹配。（参考：[什么是最左匹配原则](https://www.mianshi.online/mysql-leftmost-match.html)）

对于热点表执行 DDL 可能导致数据库崩溃，可以设置 DDL 的超时时间，然后重复执行。

update 会触发当前读

```
你好！虽然 EXPLAIN 命令可以帮助你理解 MySQL 查询的执行计划，但并不意味着它的返回值一定是正确的。EXPLAIN 命令提供了查询优化器预估的执行计划，但实际执行时可能会受到多种因素的影响，导致实际执行计划与 EXPLAIN 返回的计划略有不同。

以下是一些可能导致 EXPLAIN 返回值与实际执行计划不完全一致的情况：

数据统计不准确：MySQL 查询优化器依赖于表的统计信息来估计查询执行计划。如果统计信息不准确或者过时，优化器的预估可能会偏离实际情况。

并发和锁：在多用户环境中，查询执行计划可能会受到其他并发查询的影响，比如锁定行或表，导致执行计划发生变化。

硬件和配置差异：不同的硬件环境、MySQL版本和配置选项可能会对查询执行计划产生影响，使得实际执行计划与 EXPLAIN 返回的计划有所不同。

动态SQL：如果SQL语句中包含了变量或函数，那么优化器可能无法在预估阶段确定最佳的执行计划，因此实际执行时可能与预估有所不同。

考虑到以上因素，虽然 EXPLAIN 命令提供了有价值的信息来帮助你理解查询的执行方式，但并不保证返回的计划一定与实际执行时完全一致。因此，在优化查询性能时，除了参考 EXPLAIN 返回的信息外，还应该通过实际执行查询并进行性能测试来验证执行计划的有效性。


当你使用MySQL的EXPLAIN命令时，它会返回一个查询执行计划，这个计划告诉你MySQL将如何执行你的查询。这对于优化查询性能和理解MySQL的执行逻辑非常有用。

具体来说，EXPLAIN命令提供了以下信息：

查询执行顺序：EXPLAIN命令显示了MySQL将按照什么顺序来执行查询中的各个部分。这有助于你理解MySQL优化器的决策过程，以及它是如何组合和执行查询中的各个部分的。

表访问方法：对于涉及多个表的查询，EXPLAIN命令显示了MySQL将如何访问每个表。它告诉你MySQL是如何使用索引、全表扫描或者临时表来获取所需的数据。

索引使用情况：EXPLAIN命令显示了MySQL是否使用了索引来执行查询，以及使用了哪些索引。它还告诉你MySQL是否对索引进行了优化，例如是否使用了覆盖索引（Covering Index）。

估计的行数和过滤条件：EXPLAIN命令显示了MySQL估计将会检索或处理多少行数据，并且它也展示了哪些过滤条件会被应用在查询过程中。

连接类型：对于涉及多个表的查询，EXPLAIN命令显示了MySQL使用的连接类型，例如嵌套循环连接、哈希连接或者排序合并连接。

通过分析EXPLAIN的输出，你可以发现查询中存在的潜在性能问题，并且可以根据这些信息来优化你的查询、表结构和索引。这使得EXPLAIN成为MySQL优化工具箱中不可或缺的一部分。
```
